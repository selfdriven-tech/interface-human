/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@lapo/asn1js@2.0.4/asn1.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Int10}from"./int10.js";import{oids}from"./oids.js";const ellipsis="…",reTimeS=/^(\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|(-(?:0\d|1[0-2])|[+](?:0\d|1[0-4]))([0-5]\d)?)?$/,reTimeL=/^(\d\d\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|(-(?:0\d|1[0-2])|[+](?:0\d|1[0-4]))([0-5]\d)?)?$/,hexDigits="0123456789ABCDEF",b64Safe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",tableT61=[["",""],["AEIOUaeiou","ÀÈÌÒÙàèìòù"],["ACEILNORSUYZacegilnorsuyz","ÁĆÉÍĹŃÓŔŚÚÝŹáćéģíĺńóŕśúýź"],["ACEGHIJOSUWYaceghijosuwy","ÂĈÊĜĤÎĴÔŜÛŴŶâĉêĝĥîĵôŝûŵŷ"],["AINOUainou","ÃĨÑÕŨãĩñõũ"],["AEIOUaeiou","ĀĒĪŌŪāēīōū"],["AGUagu","ĂĞŬăğŭ"],["CEGIZcegz","ĊĖĠİŻċėġż"],["AEIOUYaeiouy","ÄËÏÖÜŸäëïöüÿ"],["",""],["AUau","ÅŮåů"],["CGKLNRSTcklnrst","ÇĢĶĻŅŖŞŢçķļņŗşţ"],["",""],["OUou","ŐŰőű"],["AEIUaeiu","ĄĘĮŲąęįų"],["CDELNRSTZcdelnrstz","ČĎĚĽŇŘŠŤŽčďěľňřšťž"]];function stringCut(t,e){return t.length>e&&(t=t.substring(0,e)+"…"),t}function checkPrintable(t){let e,r;for(e=0;e<t.length;++e)if(r=t.charCodeAt(e),r<32&&9!=r&&10!=r&&13!=r)throw new Error("Unprintable character at index "+e+" (code "+t.str.charCodeAt(e)+")")}class Stream{constructor(t,e){t instanceof Stream?(this.enc=t.enc,this.pos=t.pos):(this.enc=t,this.pos=e)}get(t){if(void 0===t&&(t=this.pos++),t>=this.enc.length)throw new Error("Requesting byte offset "+t+" on a stream of length "+this.enc.length);return"string"==typeof this.enc?this.enc.charCodeAt(t):this.enc[t]}hexByte(t){return hexDigits.charAt(t>>4&15)+hexDigits.charAt(15&t)}hexDump(t,e,r="dump"){let s="";for(let n=t;n<e;++n)if("byte"==r&&n>t&&(s+=" "),s+=this.hexByte(this.get(n)),"dump"==r)switch(15&n){case 7:s+="  ";break;case 15:s+="\n";break;default:s+=" "}return s}b64Dump(t,e){let r,s,n=(e-t)%3,i="";for(r=t;r+2<e;r+=3)s=this.get(r)<<16|this.get(r+1)<<8|this.get(r+2),i+=b64Safe.charAt(s>>18&63),i+=b64Safe.charAt(s>>12&63),i+=b64Safe.charAt(s>>6&63),i+=b64Safe.charAt(63&s);return n>0&&(s=this.get(r)<<16,n>1&&(s|=this.get(r+1)<<8),i+=b64Safe.charAt(s>>18&63),i+=b64Safe.charAt(s>>12&63),2==n&&(i+=b64Safe.charAt(s>>6&63))),i}isASCII(t,e){for(let r=t;r<e;++r){let t=this.get(r);if(t<32||t>176)return!1}return!0}parseStringISO(t,e,r){let s="";for(let r=t;r<e;++r)s+=String.fromCharCode(this.get(r));return{size:s.length,str:stringCut(s,r)}}parseStringT61(t,e,r){function s(t,e){let r=tableT61[t-192],s=r[0].indexOf(String.fromCharCode(e));return s<0?"\0":r[1].charAt(s)}let n,i="";for(let r=t;r<e;++r)n=this.get(r),i+=n>=164&&n<=191?"$¥#§¤\0\0«\0\0\0\0°±²³×µ¶·÷\0\0»¼½¾¿".charAt(n-164):n>=224&&n<=255?"ΩÆÐªĦ\0ĲĿŁØŒºÞŦŊŉĸæđðħıĳŀłøœßþŧŋ\0".charAt(n-224):n>=192&&n<=207?s(n,this.get(++r)):String.fromCharCode(n);return{size:i.length,str:stringCut(i,r)}}parseStringUTF(t,e,r){function s(t){if(t<128||t>=192)throw new Error("Invalid UTF-8 continuation byte: "+t);return 63&t}function n(t){if(t<65536)throw new Error("UTF-8 overlong encoding, codepoint encoded in 4 bytes: "+t);return t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t))}let i="";for(let r=t;r<e;){let t=this.get(r++);if(t<128)i+=String.fromCharCode(t);else{if(t<192)throw new Error("Invalid UTF-8 starting byte: "+t);if(t<224)i+=String.fromCharCode((31&t)<<6|s(this.get(r++)));else if(t<240)i+=String.fromCharCode((15&t)<<12|s(this.get(r++))<<6|s(this.get(r++)));else{if(!(t<248))throw new Error("Invalid UTF-8 starting byte (since 2003 it is restricted to 4 bytes): "+t);i+=n((7&t)<<18|s(this.get(r++))<<12|s(this.get(r++))<<6|s(this.get(r++)))}}}return{size:i.length,str:stringCut(i,r)}}parseStringBMP(t,e,r){let s,n,i="";for(let r=t;r<e;)s=this.get(r++),n=this.get(r++),i+=String.fromCharCode(s<<8|n);return{size:i.length,str:stringCut(i,r)}}parseTime(t,e,r){let s=this.parseStringISO(t,e).str,n=(r?reTimeS:reTimeL).exec(s);if(!n)throw new Error("Unrecognized time: "+s);return r&&(n[1]=+n[1],n[1]+=n[1]<70?2e3:1900),s=n[1]+"-"+n[2]+"-"+n[3]+" "+n[4],n[5]&&(s+=":"+n[5],n[6]&&(s+=":"+n[6],n[7]&&(s+="."+n[7]))),n[8]&&(s+=" UTC",n[9]&&(s+=n[9]+":"+(n[10]||"00"))),s}parseInteger(t,e){let r,s=this.get(t),n=s>127,i=n?255:0,a="";for(;s==i&&++t<e;)s=this.get(t);if(r=e-t,0===r)return n?"-1":"0";if(r>4){for(a=s,r<<=3;0==(128&(a^i));)a<<=1,--r;a="("+r+" bit)\n"}n&&(s-=256);let h=new Int10(s);for(let r=t+1;r<e;++r)h.mulAdd(256,this.get(r));return a+h.toString()}parseBitString(t,e,r){let s=this.get(t);if(s>7)throw new Error("Invalid BitString with unusedBits="+s);let n=(e-t-1<<3)-s,i="";for(let n=t+1;n<e;++n){let t=this.get(n),a=n==e-1?s:0;for(let e=7;e>=a;--e)i+=t>>e&1?"1":"0";i.length>r&&(i=stringCut(i,r))}return{size:n,str:i}}parseOctetString(t,e,r){let s,n=e-t;try{return s=this.parseStringUTF(t,e,r),checkPrintable(s.str),{size:e-t,str:s.str}}catch(t){}n>(r/=2)&&(e=t+r),s="";for(let r=t;r<e;++r)s+=this.hexByte(this.get(r));return n>r&&(s+="…"),{size:n,str:s}}parseOID(t,e,r,s){let n="",i=new Int10,a=0;for(let h=t;h<e;++h){let t=this.get(h);if(i.mulAdd(128,127&t),a+=7,!(128&t)){if(""===n)if(i=i.simplify(),s)n=i instanceof Int10?i.toString():""+i;else if(i instanceof Int10)i.sub(80),n="2."+i.toString();else{let t=i<80?i<40?0:1:2;n=t+"."+(i-40*t)}else n+="."+i.toString();if(n.length>r)return stringCut(n,r);i=new Int10,a=0}}if(a>0&&(n+=".incomplete"),"object"==typeof oids&&!s){let t=oids[n];t&&(t.d&&(n+="\n"+t.d),t.c&&(n+="\n"+t.c),t.w&&(n+="\n(warning!)"))}return n}parseRelativeOID(t,e,r){return this.parseOID(t,e,r,!0)}}function recurse(t,e,r){let s=!0;if(t.tag.tagConstructed&&t.sub&&(s=!1,t.sub.forEach((function(e){e.tag.tagClass==t.tag.tagClass&&e.tag.tagNumber==t.tag.tagNumber||(s=!0)}))),s)return t.stream[e](t.posContent(),t.posContent()+Math.abs(t.length),r);let n={size:0,str:""};return t.sub.forEach((function(t){let s=recurse(t,e,r-n.str.length);n.size+=s.size,n.str+=s.str})),n}class ASN1Tag{constructor(t){let e=t.get();if(this.tagClass=e>>6,this.tagConstructed=0!=(32&e),this.tagNumber=31&e,31==this.tagNumber){let r=new Int10;do{e=t.get(),r.mulAdd(128,127&e)}while(128&e);this.tagNumber=r.simplify()}}isUniversal(){return 0===this.tagClass}isEOC(){return 0===this.tagClass&&0===this.tagNumber}}export class ASN1{constructor(t,e,r,s,n,i){if(!(s instanceof ASN1Tag))throw new Error("Invalid tag value.");this.stream=t,this.header=e,this.length=r,this.tag=s,this.tagLen=n,this.sub=i}typeName(){switch(this.tag.tagClass){case 0:switch(this.tag.tagNumber){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 13:return"RELATIVE_OID";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString"}return"Universal_"+this.tag.tagNumber.toString();case 1:return"Application_"+this.tag.tagNumber.toString();case 2:return"["+this.tag.tagNumber.toString()+"]";case 3:return"Private_"+this.tag.tagNumber.toString()}}content(t){if(void 0===this.tag)return null;void 0===t&&(t=1/0);let e=this.posContent(),r=Math.abs(this.length);if(!this.tag.isUniversal()){if(null!==this.sub)return"("+this.sub.length+" elem)";let s=this.stream.parseOctetString(e,e+r,t);return"("+s.size+" byte)\n"+s.str}switch(this.tag.tagNumber){case 1:return 0===this.stream.get(e)?"false":"true";case 2:case 10:return this.stream.parseInteger(e,e+r);case 3:{let e=recurse(this,"parseBitString",t);return"("+e.size+" bit)\n"+e.str}case 4:{let e=recurse(this,"parseOctetString",t);return"("+e.size+" byte)\n"+e.str}case 6:return this.stream.parseOID(e,e+r,t);case 13:return this.stream.parseRelativeOID(e,e+r,t);case 16:case 17:return null!==this.sub?"("+this.sub.length+" elem)":"(no elem)";case 12:return recurse(this,"parseStringUTF",t).str;case 20:return recurse(this,"parseStringT61",t).str;case 18:case 19:case 21:case 22:case 26:case 27:return recurse(this,"parseStringISO",t).str;case 30:return recurse(this,"parseStringBMP",t).str;case 23:case 24:return this.stream.parseTime(e,e+r,23==this.tag.tagNumber)}return null}toString(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null===this.sub?"null":this.sub.length)+"]"}toPrettyString(t){void 0===t&&(t="");let e=t;this.def&&(this.def.id&&(e+=this.def.id+" "),this.def.name&&this.def.name!=this.typeName().replace(/_/g," ")&&(e+=this.def.name+" "),this.def.mismatch&&(e+="[?] ")),e+=this.typeName()+" @"+this.stream.pos,this.length>=0&&(e+="+"),e+=this.length,this.tag.tagConstructed?e+=" (constructed)":!this.tag.isUniversal()||3!=this.tag.tagNumber&&4!=this.tag.tagNumber||null===this.sub||(e+=" (encapsulates)");let r=this.content();if(r&&(e+=": "+r.replace(/\n/g,"|")),e+="\n",null!==this.sub){t+="  ";for(let r=0,s=this.sub.length;r<s;++r)e+=this.sub[r].toPrettyString(t)}return e}posStart(){return this.stream.pos}posContent(){return this.stream.pos+this.header}posEnd(){return this.stream.pos+this.header+Math.abs(this.length)}posLen(){return this.stream.pos+this.tagLen}toHexString(t="raw"){return this.stream.hexDump(this.posStart(),this.posEnd(),t)}toB64String(){return this.stream.b64Dump(this.posStart(),this.posEnd())}static decodeLength(t){let e=t.get(),r=127&e;if(r==e)return r;if(0===r)return null;if(r>6)throw new Error("Length over 48 bits not supported at position "+(t.pos-1));e=0;for(let s=0;s<r;++s)e=256*e+t.get();return e}static decode(t,e,r=ASN1){if(!(r==ASN1||r.prototype instanceof ASN1))throw new Error("Must pass a class that extends ASN1");t instanceof Stream||(t=new Stream(t,e||0));let s=new Stream(t),n=new ASN1Tag(t),i=t.pos-s.pos,a=ASN1.decodeLength(t),h=t.pos,o=h-s.pos,u=null,g=function(){if(u=[],null!==a){let e=h+a;if(e>t.enc.length)throw new Error("Container at offset "+h+" has a length of "+a+", which is past the end of the stream");for(;t.pos<e;)u[u.length]=r.decode(t);if(t.pos!=e)throw new Error("Content size is not correct for container at offset "+h)}else try{for(;;){let e=r.decode(t);if(e.tag.isEOC())break;u[u.length]=e}a=h-t.pos}catch(t){throw new Error("Exception while decoding undefined length content at offset "+h+": "+t)}};if(n.tagConstructed)g();else if(n.isUniversal()&&(3==n.tagNumber||4==n.tagNumber))try{if(3==n.tagNumber&&0!=t.get())throw new Error("BIT STRINGs with unused bits cannot encapsulate.");g();for(let t of u){if(t.tag.isEOC())throw new Error("EOC is not supposed to be actual content.");try{t.content()}catch(t){throw new Error("Unable to parse content: "+t)}}}catch(t){u=null}if(null===u){if(null===a)throw new Error("We can't skip over an invalid tag with undefined length at offset "+h);t.pos=h+Math.abs(a)}return new r(s,o,a,n,i,u)}}
//# sourceMappingURL=/sm/942102d78e770e5443f7a12e2d8c5e819a33de0dc5966d594f90a114499a2eb8.map